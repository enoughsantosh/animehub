<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Browse and discover anime across different categories">
    <meta name="theme-color" content="#000000">
    <title>AnimeHub - Discover Your Next Favorite Anime</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    
    <!-- Preload critical assets -->
    <link rel="preconnect" href="https://aniscrap.vercel.app">
    
    <style>
        /* Improved scrollbar visibility */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #4a5568 #2d3748;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 8px;
            border: 2px solid #2d3748;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #2d3748;
            border-radius: 8px;
        }

        /* Enhanced gradient overlay */
        .gradient-overlay {
            background: linear-gradient(
                to top,
                rgba(0, 0, 0, 0.95) 0%,
                rgba(0, 0, 0, 0.6) 40%,
                rgba(0, 0, 0, 0.2) 70%,
                rgba(0, 0, 0, 0) 100%
            );
        }

        /* Smooth hover animations */
        .hover-scale {
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1),
                        box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform, box-shadow;
        }
        
        .hover-scale:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        /* Skeleton loading animation */
        .skeleton {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.1) 25%,
                rgba(255, 255, 255, 0.2) 37%,
                rgba(255, 255, 255, 0.1) 63%
            );
            background-size: 400% 100%;
            animation: skeleton-loading 1.4s ease infinite;
        }

        @keyframes skeleton-loading {
            0% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0 50%;
            }
        }

        /* Improved focus styles */
        :focus-visible {
            outline: 2px solid #ef4444;
            outline-offset: 2px;
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }

        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            .hover-scale {
                transition: none;
            }
            html {
                scroll-behavior: auto;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-black text-white">
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-red-600 text-white px-4 py-2 rounded-md">
        Skip to main content
    </a>

    <!-- Navigation Bar -->
    <nav class="fixed top-0 w-full bg-gradient-to-b from-black via-black to-transparent z-50 px-4 py-4 shadow-lg" role="navigation">
        <div class="container mx-auto flex items-center justify-between">
            <a href="/" class="text-2xl md:text-3xl font-bold text-red-600 hover:text-red-500 transition-colors" aria-label="AnimeHub Home">
                AnimeHub
            </a>
            <div class="flex items-center space-x-4">
                <button class="text-white hover:text-gray-300 transition-colors focus:outline-none" aria-label="Browse anime">
                    Browse
                </button>
                <button class="text-white hover:text-gray-300 transition-colors focus:outline-none" aria-label="Search anime">
                    Search
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative w-full bg-cover bg-center min-h-[50vh]" style="background-image: url('/api/placeholder/1920/1080');" role="banner">
        <div class="absolute inset-0 gradient-overlay"></div>
        <div class="absolute bottom-0 left-0 p-8 md:p-16 w-full">
            <h1 class="text-3xl md:text-5xl font-bold mb-4">Featured Anime</h1>
            <p class="text-lg md:text-xl mb-6 max-w-2xl">Discover the latest and greatest anime series across different categories.</p>
            <button class="bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-black" aria-label="Explore anime categories">
                Explore Now
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="container mx-auto px-4 py-24 -mt-16 relative z-10">
        <!-- Loading state -->
        <div id="loading" class="flex flex-col items-center justify-center py-12" role="status">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-red-600 border-t-transparent"></div>
            <p class="mt-4 text-gray-400">Loading anime categories...</p>
        </div>

        <!-- Error message -->
        <div id="error" class="hidden text-red-500 text-center py-8" role="alert"></div>

        <!-- Categories grid -->
        <div id="categories" class="space-y-12 py-12"></div>

        <!-- No results message -->
        <div id="no-results" class="hidden text-center py-8 text-gray-400">
            <p>No anime categories available at the moment.</p>
            <button class="mt-4 bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition-colors" onclick="loadCategories()">
                Try Again
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 py-8 mt-16">
        <div class="container mx-auto px-4">
            <p class="text-center">&copy; 2025 AnimeHub. All rights reserved.</p>
        </div>
    </footer>

    <script>
    // Utility functions
    const debounce = (fn, delay) => {
        let timeoutId;
        return (...args) => {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => fn(...args), delay);
        };
    };

    const handleError = (error, element) => {
        console.error('Error:', error);
        element.textContent = error.message || "An unexpected error occurred. Please try again later.";
        element.classList.remove('hidden');
    };

    // Create anime card component
    const createAnimeCard = (anime) => {
        const card = document.createElement('div');
        card.className = 'group cursor-pointer flex-none w-[150px] hover-scale';
        card.setAttribute('role', 'article');
        
        card.innerHTML = `
            <div class="relative aspect-[2/3] overflow-hidden rounded-md">
                <img 
                    src="${anime.image || '/api/placeholder/300/450'}" 
                    alt="${anime.title}" 
                    class="w-40 h-full object-cover"
                    loading="lazy"
                    onerror="this.src='/api/placeholder/300/450'"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <div class="absolute bottom-0 left-0 right-0 p-2">
                        <h3 class="text-sm font-medium text-white truncate">${anime.title}</h3>
                        ${anime.episode ? `<p class="text-xs text-gray-300 mt-1">Episode ${anime.episode}</p>` : ''}
                        ${anime.season ? `<p class="text-xs text-gray-300">Season ${anime.season}</p>` : ''}
                    </div>
                </div>
            </div>
        `;

        card.addEventListener('click', () => {
            const params = new URLSearchParams({
                title: anime.title,
                image: anime.image || '',
                link: anime.link || '',
                season: anime.season || '',
                episode: anime.episode || ''
            });
            window.location.href = `anime.html?${params.toString()}`;
        });

        return card;
    };

    // Load categories
    const loadCategories = async () => {
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const categoriesEl = document.getElementById('categories');
        const noResultsEl = document.getElementById('no-results');

        // Reset state
        loadingEl.classList.remove('hidden');
        errorEl.classList.add('hidden');
        categoriesEl.innerHTML = '';
        noResultsEl.classList.add('hidden');

        try {
            const response = await fetch('https://aniscrap.vercel.app/anime/categories');
            if (!response.ok) throw new Error(`Failed to fetch data (${response.status})`);
            
            const data = await response.json();
            const categories = Object.entries(data).filter(([category, animes]) => 
                category && Array.isArray(animes) && animes.length > 0
            );

            if (categories.length === 0) {
                noResultsEl.classList.remove('hidden');
                return;
            }

            categories.forEach(([category, animes]) => {
                const section = document.createElement('section');
                section.className = 'category-section';
                section.setAttribute('aria-label', category);
                
                section.innerHTML = `
                    <h2 class="text-xl font-bold mb-4 text-white pl-2">${category}</h2>
                    <div class="relative group">
                        <div class="overflow-x-auto custom-scrollbar" role="region" aria-label="${category} anime list">
                            <div class="flex space-x-3 p-2"></div>
                        </div>
                        <button class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 p-2 rounded-r-md hover:bg-opacity-75 hidden group-hover:block focus:outline-none" aria-label="Scroll left">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <button class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 p-2 rounded-l-md hover:bg-opacity-75 hidden group-hover:block focus:outline-none" aria-label="Scroll right">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                `;

                const container = section.querySelector('.flex');
                animes.forEach(anime => {
                    container.appendChild(createAnimeCard(anime));
                });

                // Scroll buttons functionality
                const scrollContainer = section.querySelector('.overflow-x-auto');
                const leftBtn = section.querySelector('button[aria-label="Scroll left"]');
                const rightBtn = section.querySelector('button[aria-label="Scroll right"]');

                const scroll = (direction) => {
                    const scrollAmount = direction * (scrollContainer.clientWidth * 0.8);
                    scrollContainer.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                };

                leftBtn.addEventListener('click', () => scroll(-1));
                rightBtn.addEventListener('click', () => scroll(1));

                categoriesEl.appendChild(section);
            });
        } catch (error) {
            handleError(error, errorEl);
        } finally {
            loadingEl.classList.add('hidden');
        }
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', loadCategories);

    // Handle offline/online states
    window.addEventListener('online', () => {
        const errorEl = document.getElementById('error');
        if (errorEl.textContent.includes('offline')) {
            loadCategories();
        }
    });

    window.addEventListener('offline', () => {
        const errorEl = document.getElementById('error');
        errorEl.textContent = "You're currently offline. Please check your internet connection.";
        errorEl.classList.remove('hidden');
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
            const focused = document.activeElement;
            if (focused && focused.classList.contains('group')) {
                const direction = e.key === 'ArrowLeft' ? -1 : 1;
                const container = focused.closest('.overflow-x-auto');
                if (container) {
                    container.scrollBy({ 
                        left: direction * (container.clientWidth * 0.8), 
                        behavior: 'smooth' 
                    });
                }
            }
        }
    });
    </script>
</body>
</html>